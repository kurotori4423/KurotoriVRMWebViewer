# 開発ガイドライン・ベストプラクティス

## 開発の基本方針

### 実装アプローチ
1. **段階的実装**: シンプルな機能から開始し、徐々に機能追加
2. **モジュール分割**: 機能ごとにファイルを分けて管理しやすく
3. **必要最小限**: 実装時に余計な機能を追加せず、必要に応じて拡張
4. **テスト駆動**: 一つの機能実装後は必ずPlaywrightでテスト実行

### コーディング規約

#### 命名規則
- **変数・関数**: camelCase (`loadVRM`, `selectedModel`)
- **クラス**: PascalCase (`VRMViewer`, `VRMBoneController`)
- **定数**: UPPER_SNAKE_CASE (`DEFAULT_FOV`)
- **ファイル**: PascalCase for classes, camelCase for utilities

#### コメント規約
```typescript
/**
 * VRMファイルを読み込んでシーンに追加する
 * @param file 読み込むVRMファイル
 * @returns Promise<VRM> 読み込まれたVRMオブジェクト
 */
async loadVRM(file: File): Promise<VRM> {
    // 複雑なロジックには行コメントで説明
    const arrayBuffer = await file.arrayBuffer();
    // ...
}
```

## Windows開発環境での注意点

### ターミナルコマンド
- PowerShellまたはコマンドプロンプト使用
- `&&` の代わりに `;` でコマンド連結
- 一つずつコマンド実行（複数同時実行は避ける）

```powershell
# 良い例
npm install
npm run build

# 避ける例
npm install && npm run build
```

### パス区切り文字
- Windows: `\` (バックスラッシュ)
- ファイルパス指定時は適切なエスケープを行う

## Git運用ルール

### コミットメッセージ
- **フォーマット**: `[カテゴリ] 変更内容の要約`
- **カテゴリ例**: 
  - `[feat]` 新機能追加
  - `[fix]` バグ修正
  - `[refactor]` リファクタリング
  - `[docs]` ドキュメント更新
  - `[test]` テスト追加・修正

### ブランチ戦略
- `main`: 安定版
- `develop`: 開発版
- `feature/*`: 機能ブランチ

## テスト方針

### Playwright MCP活用
- 各機能実装後は必ずブラウザテストを実行
- 自動化されたテストスクリプトの作成を推奨
- クロスブラウザ対応の確認

### テスト項目
1. **基本動作**: ページ読み込み、UI表示
2. **ファイル操作**: VRM読み込み、ドラッグ&ドロップ
3. **インタラクション**: モデル選択、メタ情報表示
4. **エラーハンドリング**: 不正ファイル、ネットワークエラー

## パフォーマンス考慮事項

### 3Dレンダリング最適化
- 不要なレンダリング回数削減
- モデルの適切なLOD（Level of Detail）管理
- メモリリーク防止（dispose処理の徹底）

### ファイル読み込み最適化
- 大容量VRMファイルの進捗表示
- 非同期処理でのUI応答性確保

## エラーハンドリング

### エラー分類
1. **ユーザーエラー**: 不正ファイル形式、サイズ超過
2. **システムエラー**: メモリ不足、ネットワーク障害
3. **開発エラー**: 実装バグ、型エラー

### エラー表示方針
- ユーザーフレンドリーなメッセージ
- 技術的詳細はコンソールログに出力
- 復旧方法の提示

## 修正・改善プロセス

### 修正依頼への対応
1. `Docs/Todo.md` に修正内容を追加
2. 修正の優先度設定
3. 実装後のテスト実行
4. 動作確認とフィードバック

### 継続的改善
- 定期的なコードレビュー実施
- パフォーマンス測定と最適化

## セキュリティ考慮

### ファイルアップロード
- ファイル形式の厳格なチェック
- サイズ制限の実装
- XSS対策（ユーザー入力のサニタイズ）

### 外部リソース
- VRoidHub API利用時のセキュリティ
- CORS設定の適切な管理