# VRMビューワー 実装Todo

## フェーズ1: 基盤構築 🏗️

### 1.0 Gitリポジトリの初期化
- [x] Gitリポジトリの初期化
- [x] .gitign### 3.1 VRMメタ情報の表示
- [x] メタ情報パネルの作成
  - [x] 読み込み済モデルリストにInfoボタンを追加
  - [x] メタ情報モーダルウィンドウのUI作成
  - [x] ×ボタン、ESCキー、背景クリックでの閉じる機能
- [x] モデル名、作者、ライセンス情報の表示
- [x] サムネイル画像の表示（実装完了）
- [x] VRMバージョン情報の表示
- [x] **VRM0/VRM1バージョン検知とメタ情報対応** ✨
  - [x] VRM0系の特徴的プロパティ（title, author, commercialUssageName等）による正確なバージョン検知
  - [x] VRM1系とVRM0系のメタ情報構造の違いに対応した正規化処理
  - [x] VRM0系: title→name変換, author→authors配列変換, 詳細なライセンス情報表示
  - [x] VRM1系: 既存のname, authors配列, 商用利用・改変許可等の表示
  - [x] バージョンごとの適切なUI表示分岐（バージョンバッジ、ライセンス詳細、サムネイル等）
- [x] **VRM1系メタ情報表示の充実** ✨
  - [x] 再配布許可・クレジット表記・サードパーティライセンス項目の追加
  - [x] 使用許可・利用制限セクションの実装
    - [x] アバター使用許可（onlyAuthor, onlySeparatelyLicensedPerson, everyone）
    - [x] 過激な暴力表現許可（allowExcessivelyViolentUsage）
    - [x] 過激な性的表現許可（allowExcessivelySexualUsage）
    - [x] 政治・宗教利用許可（allowPoliticalOrReligiousUsage）
    - [x] 反社会的・ヘイト利用許可（allowAntisocialOrHateUsage）
  - [x] 公式ドキュメントに基づく完全なVRM1.0メタ情報対応
- [x] Playwrightでの動作確認完了
  - [x] VRM0/VRM1両方でのバージョン検知確認
  - [x] 各バージョンのメタ情報表示確認
  - [x] 複数モデルでの動作確認
  - [x] モーダル開閉の動作確認
  - [x] モデル選択機能への影響なし確認
  - [x] VRM1系の充実したメタ情報表示確認- [x] 初回コミットの実行

### 1.1 開発環境セットアップ
- [x] Viteプロジェクトの初期化
- [x] TypeScript設定
- [x] 必要なライブラリのインストール
  - [x] three.js
  - [x] @pixiv/three-vrm
  - [x] lil-gui
- [x] 基本的なディレクトリ構造の作成

### 1.2 基本的な3Dシーンの構築
- [x] three.jsの基本セットアップ（Scene, Camera, Renderer）
- [x] OrbitControlsの追加（カメラ操作）
- [x] 基本的なライティングの設定
- [x] グリッドとアックスヘルパーの表示
- [x] ブラウザでの表示確認

## フェーズ2: VRM基本機能 📱

### 2.1 VRMファイルの読み込み
- [x] ファイル選択UIの作成
- [x] VRMローダーの実装
- [x] VRM0系の読み込み対応
- [x] VRM1系の読み込み対応
- [x] エラーハンドリングの実装

### 2.2 VRMモデルの表示
- [x] VRMモデルをシーンに追加
- [x] モデルの中央配置
- [x] モデルのスケール調整機能
- [x] 複数体表示の基本実装
- [x] VRMモデルリスト表示機能
  - [x] 読み込み済みモデルのリスト表示UI作成
  - [x] モデル名・サムネイル・読み込み順序の表示
  - [x] リスト項目のクリック選択機能  - [x] モデル選択UI実装
    - [x] 現在選択中のモデルの明確な識別
    - [x] 選択状態の視覚的フィードバック
    - [x] キーボード（上下矢印）での選択切り替え
- [x] 選択されたモデルの強調表示
  - [x] 3Dシーン内でのアウトライン表示
  - [x] モデルの一時的なハイライト効果
  - [x] カメラの自動フォーカス機能
  - [x] **バグ修正**: 複数体配置時のアウトライン位置ずれ（シンプルな固定オフセット方式で完全解決）
- [x] 個別モデル操作機能
  - [x] 選択モデルのみの移動・回転・スケール
  - [x] 選択モデルの表示/非表示切り替え
  - [x] 選択モデルの削除機能
  - [x] 選択モデルの複製機能（元データからの再読み込み方式で修正完了）
  - [x] **バグ修正**: モデル選択切り替え時のスライダー値同期（現在選択されたモデルのスケール値にスライダーを更新）

### 2.3 基本的なカメラ・ライト操作
- [x] **three-viewport-gizmoの導入**
  - [x] three-viewport-gizmoライブラリのインストール
  - [x] OrbitControls連携の実装
  - [x] カメラ視点操作ギズモの表示・動作確認
  - [x] UIとの統合（位置調整・スタイル設定）
- [x] カメラ位置のリセット機能
  - [x] デフォルト位置への即座復帰
  - [x] 全体表示への自動調整
  - [x] 滑らかなアニメーション付きリセット
- [x] ライトの明度調整
  - [x] 環境光の強度調整スライダー
  - [x] 方向性ライトの強度調整
  - [x] 複数ライトの統合制御
- [x] 背景色の変更機能
  - [x] カラーピッカーUI
  - [x] プリセット背景色ボタン
  - [x] グラデーション背景の実装

### 2.4 UI整理・改善
- [x] 左サイドバーのレイアウト整理
  - [x] VRMファイル読み込みボタンのシンプル化
  - [x] 読み込み済モデル一覧の配置最適化
  - [x] ライト設定・背景設定の整理
- [x] VRMファイル読み込みモーダルの実装
  - [x] 中央モーダルウィンドウの作成
  - [x] サンプル追加ボタンの移動
  - [x] ドラッグ&ドロップ領域の移動
  - [x] ×ボタンでの閉じる機能
  - [x] ESCキーでの閉じる機能
  - [x] プリセットボタンの統合
- [x] 選択モデル詳細ウィンドウの実装
  - [x] 画面右下のモデル操作ウィンドウ作成
  - [x] スケール設定の移動
  - [x] フォーカス・非表示・削除ボタンの移動
  - [x] 今後の拡張に対応したUI設計
  - [x] ×ボタンでの閉じる機能

## フェーズ3: メタ情報と基本UI 📋 ✅

### 3.1 VRMメタ情報表示
- [x] メタ情報パネルの作成
  - [x] 読み込み済モデルリストにInfoボタンを追加
  - [x] メタ情報モーダルウィンドウのUI作成
  - [x] ×ボタン、ESCキー、背景クリックでの閉じる機能
- [x] モデル名、作者、ライセンス情報の表示
- [x] サムネイル画像の表示（実装完了）
  - [x] **VRM1系のサムネイル画像表示対応（完全解決）** ✨
    - [x] HTMLImageElementをCanvas APIでDataURLに変換
    - [x] extractVRM1ThumbnailImage関数でVRM1統一処理実装
  - [x] **VRM0系のサムネイル画像表示対応（完全解決）** ✨
    - [x] textureプロパティからImageBitmap/HTMLImageElement対応
    - [x] extractVRM0ThumbnailImage関数でcanvas変換実装
    - [x] **main.ts表示バグ修正**: thumbnailImage.src → thumbnailImageに修正してDataURL表示を正常化
  - [x] **VRM0/VRM1統一サムネイル処理完成**: 両方ともDataURL文字列で統一し、美しいサムネイル表示を実現
  - [x] **サムネイル横並びレイアウト完成** ✨
    - [x] 基本情報セクションでサムネイル画像（左）と基本情報（右）の横並び表示
    - [x] レスポンシブ対応（狭い画面では縦並びに自動切り替え）
    - [x] CSS `basic-info-container`, `thumbnail-container`, `meta-thumbnail-inline`, `basic-info-details`完成
    - [x] VRM0/VRM1両方での横並びレイアウト動作確認完了
- [x] VRMバージョン情報の表示
  - [x] VRM0/VRM1の自動検知とメタ情報正規化
  - [x] バージョンごとの適切なメタ情報項目表示
- [x] Playwrightでの動作確認完了
  - [x] 複数モデルでの動作確認
  - [x] モーダル開閉の動作確認
  - [x] モデル選択機能への影響なし確認
  - [x] VRM0/VRM1サンプルでのサムネイル表示確認完了

### 3.2 ライト調整機能 ✅
- [x] ライト色の調整機能
  - [x] 環境光（AmbientLight）の色調整
  - [x] 方向性ライト（DirectionalLight）の色調整
  - [x] リムライト（RimLight）の色調整
  - [x] カラーピッカーUIの実装
- [x] 方向性ライトの視覚化と操作
  - [x] DirectionalLightHelperの表示
  - [x] ライトヘルパーのクリック検出（表示/非表示切り替え）
  - [x] TransformControlsによるライト回転機能
  - [x] ライト選択時のハイライト表示（ボタン状態変更）
- [x] ライト設定の保存・復元
  - [x] ライト設定のプリセット機能（デフォルトリセット）
  - [x] デフォルトライトへのリセット機能（色・位置・強度・UI状態）
- [x] **ライト回転操作の品質向上** ✨
  - [x] ライト位置を3m高度に調整（0, 3, 0）
  - [x] 方向性ライト選択時の向き変更問題の修正
  - [x] TransformControlsのプロキシオブジェクトによる正確な回転制御
  - [x] 初期選択時の微小数値誤差によるchangeイベント抑制
  - [x] ライト方向の維持とギズモ操作によるデルタ回転のみ適用
  - [x] **directionalLightProxyの可視性制御とデバッグ機能追加** ✨
    - [x] isDraggingフラグによるchangeイベントの「ドラッグ中のみ」制御実装
    - [x] directionalLightProxyをワイヤーフレーム立方体（Mesh）に変更し視覚的確認可能
    - [x] ライト選択時のプロキシ表示・選択解除時の正確な非表示制御
    - [x] setLightProxyVisible/isLightProxyVisibleメソッドの実装
    - [x] プロキシ可視性制御の完全な動作確認（選択/選択解除の切り替え正常）
    - [x] **プロキシ回転量とライト回転量の同期修正** ✨
      - [x] lightInitialDirectionプロパティ追加（ライトの初期方向保存用）
      - [x] dragging-changedイベントでドラッグ開始時にプロキシとライトの初期状態を保存
      - [x] changeイベントで保存された初期状態から正確な差分回転を計算
      - [x] proxyInitialQuaternionの管理タイミング修正（enableではなくドラッグ開始時）
      - [x] Math.acosの範囲外エラー防止（Math.min(1.0, Math.abs(deltaQuaternion.w))）
      - [x] 初期状態クリア処理の完全実装（disable/resetLights両方で対応）
- [x] Playwrightでの動作確認完了
  - [x] VRM0サンプルでの全機能テスト
  - [x] ライト色変更・ヘルパー表示・TransformControls操作確認
  - [x] リセット機能の完全動作確認
  - [x] ライト選択時の方向保持確認（方向の変化: 0）
  - [x] **プロキシ可視性制御の完全動作確認**
    - [x] マウスオーバーのみではライトが回転しないことを確認
    - [x] ワイヤーフレーム立方体の表示/非表示の正常な切り替えを確認
    - [x] TransformControlsギズモの選択状態に応じた正確な表示制御確認
    - [x] **プロキシ・ライト回転同期の修正確認**
      - [x] ドラッグ開始時の初期状態保存機能のコンソール出力確認
      - [x] ライトヘルパー表示によるライト照射方向の視覚的確認
      - [x] リセット機能による初期状態クリアの動作確認
      - [x] プロキシとギズモの表示/非表示制御の完全動作確認

### 3.2.1 3Dビューでの直感的ライト選択機能
- [x] **3Dビュー上でのライト選択実装** ✨
  - [x] Raycastingによる3Dオブジェクトクリック検出
  - [x] ライトヘルパー用の当たり判定実装
    - [x] DirectionalLightHelper直接選択（可能な場合）
    - [x] 改善案：直径2mの透明球形コライダー作成・配置（選択性向上）
  - [x] マウスクリックイベントハンドラー実装
    - [x] ライトヘルパー（またはコライダー）クリック → ライト選択状態
    - [x] 空の3Dスペースクリック → ライト選択解除
    - [x] TransformControls使用中は無効化（干渉防止）
    - [x] **TransformControlsのドラッグ後も選択状態を維持する改善** ✨
      - [x] clickイベントをmousedownイベントに変更して根本的に解決
      - [x] TransformControlsによる操作後もライト選択が継続する挙動を実現
      - [x] 一時的なignoreClickAfterDragフラグによる回避策を廃止し、根本的に修正
      - [x] mousedownイベントを利用することで、ドラッグ後のclickイベントによる誤選択解除を根絶
  - [x] 既存GUIボタンとの統合
    - [x] 3Dビュー選択とボタン状態の同期
    - [x] ボタンクリック時も3Dビュー選択状態に反映
  - [ ] 視覚的フィードバック強化（将来対応として保留）
    - [ ] ライト選択時のハイライト表現
    - [ ] マウスオーバー時のホバー効果（任意）
  - [x] **改善完了** 📝 2024-01-15

**✅ 実装完了**: 3Dビューでの直感的ライト選択機能が正常に動作中。透明球体コライダー（直径2m）による当たり判定、GUIボタンとの同期、TransformControls干渉防止が全て実装済み。Playwright MCPによる自動テストも実施済み。
**📝 改善完了**: ライトヘルパーの初期表示状態、選択維持機能、リセット時の表示状態維持を実装。

## フェーズ4: ポージング機能 🎨

### 4.1 ボーン操作の基礎
- [x] **VRMボーンの可視化と操作** ✨
  - [x] VRMヒューマノイドボーン構造の解析
    - [x] @pixiv/three-vrm APIを使用したボーン階層へのアクセス
    - [x] VRMHumanoid.rawBonesのマッピングと整理
    - [x] 主要ボーン（頭、首、腕、手など）の特定と分類
  - [x] ボーン階層の視覚化
    - [x] SkeletonHelperによる全体骨格の表示
    - [x] 主要ボーンポイントの視覚化（小さな球体オブジェクト）
    - [x] 選択可能なボーン表示/非表示切り替え機能
    - [x] 骨格表示の色・透明度設定（左側は赤系、右側は青系、中央は緑系で色分け）
  - [x] ボーン選択システム
    - [x] Raycastingによる3Dビュー上でのボーン選択
    - [x] 選択したボーンのハイライト表示（TransformControls）
    - [ ] ボーンリストUIからの選択機能（将来実装予定）
- [x] **TransformControlsとの統合** ✨
  - [x] 選択されたボーンへのTransformControlsアタッチ
  - [x] 回転モード（Rotate）の実装
    - [ ] ローカル/ワールド座標系の切り替え（将来実装予定）
    - [ ] 回転制限の実装（人体の自然な可動域）（将来実装予定）
  - [x] 移動モード（Position）の実装（オプション）
  - [x] UI上での操作モード切り替え（回転/移動ボタン）
- [x] **ボーン回転の実装** ✨
  - [x] クォータニオンを使用した回転操作
  - [x] 親ボーンから子ボーンへの階層的変換の伝播
  - [ ] 回転角度の保存と管理（将来実装予定）
  - [ ] IK制約との連携準備（将来拡張用）
- [x] **ポーズのリセット機能** ✨
  - [x] 初期姿勢（T-pose）への復元機能
  - [x] 個別ボーンのリセット機能
  - [ ] 部分的なボーングループのリセット（上半身/下半身など）（将来実装予定）
- [x] **UI統合とイベントハンドラー** ✨
  - [x] ボーン表示/非表示切り替えボタンの実装
  - [x] ポーズリセットボタンの実装
  - [x] 回転/移動モード切り替えボタンの実装
  - [x] ボーン選択状態変更のコールバック機能
  - [x] 3Dビューでのマウス選択とライト選択の競合回避

**✅ 実装完了**: VRMボーンの可視化と操作の基本機能を実装しました。SkeletonHelperとボーンポイントによる骨格の視覚化、Raycastingによるボーン選択、TransformControlsによる回転・移動操作、ポーズのリセット機能、UI統合など全ての基本機能が実装済みです。

**📝 機能テスト完了 2024-06-27**: 
- VRMサンプル読み込み（54ボーン解析、17主要ボーンポイント配置）正常動作確認
- ボーン表示/非表示切り替え機能の動作確認
- 回転モード/移動モード切り替え機能の動作確認  
- ポーズリセット機能の動作確認
- 全てのボーン操作UIが正常に機能することをPlaywright MCPで確認済み

**🔧 最前面表示修正 2024-06-27**:
- **ボーン可視化の最前面表示対応** ✨
  - [x] SkeletonHelperの描画順序・深度テスト最適化（renderOrder=Number.MAX_SAFE_INTEGER-1, depthTest/Write=false, 黄色表示で視認性向上）
  - [x] ボーンポイント球体の最前面表示設定（renderOrder=Number.MAX_SAFE_INTEGER, opacity=0.9, サイズ0.035に調整）
  - [x] 3Dモデルの前面に確実にボーン要素を表示（モデル内部に隠れる問題を解決）
  - [x] Playwright MCPでの動作確認（ボーン表示/非表示切り替え、最前面表示の視覚的確認完了）
- **UI表示・操作性の改善**:
  - [x] 「選択モデル操作」ウィンドウでのボーン操作UI統合確認
  - [x] ボタン状態の正しい切り替え（「ボーン表示」⇔「ボーン非表示」）動作確認
  - [x] ポーズリセット・回転/移動モード切り替えの正常動作確認

### 4.2 表情制御
- [ ] BlendShapeの取得と表示
- [ ] 表情のスライダー制御
- [ ] プリセット表情の実装

### 4.3 基本的なポージング
- [ ] 手・腕のポージング
- [ ] 頭・首のポージング
- [ ] 基本的な全身ポーズの保存・読み込み

## フェーズ5: 高度な機能 ⚡

### 5.1 VRMAアニメーション
- [ ] VRMAファイルの読み込み
- [ ] アニメーション再生機能
- [ ] 再生コントロール（再生、停止、シーク）

### 5.2 IKシステム
- [ ] 基本的なIKソルバーの実装
- [ ] 手・足のIK操作
- [ ] 視線IKの実装

### 5.3 複数体管理
- [ ] 複数VRMの管理システム
- [ ] モデル選択UI
- [ ] 個別のポーズ管理

## フェーズ6: パフォーマンス最適化・エラーハンドリング 🚀

### 6.1 パフォーマンス最適化
- [ ] レンダリング最適化
  - [ ] フラストラムカリング適用
  - [ ] LOD（Level of Detail）システム実装
  - [ ] 描画バッチング最適化
- [ ] メモリ管理
  - [ ] テクスチャ圧縮・最適化
  - [ ] 不要なリソースの自動解放
  - [ ] メモリ使用量監視機能
- [ ] 読み込み最適化
  - [ ] プログレッシブ読み込み
  - [ ] キャッシュ機能実装
  - [ ] 非同期処理の最適化

### 6.2 エラーハンドリング強化
- [ ] ユーザーフレンドリーなエラー表示
  - [ ] 詳細なエラーメッセージ
  - [ ] 解決策の提案機能
  - [ ] エラーログの保存・共有
- [ ] 復旧機能
  - [ ] 自動復旧の試行
  - [ ] セーフモードの実装
  - [ ] バックアップ・復元機能

## フェーズ7: モバイル対応・外部連携 📱

### 7.1 モバイル対応
- [ ] タッチ操作の実装
- [ ] レスポンシブデザインの適用
- [ ] モバイル向けパフォーマンス最適化

### 7.2 VRoidHub連携
- [ ] VRoidHub APIの調査
- [ ] 認証機能の実装
- [ ] モデル検索・ダウンロード機能

## 現在の優先タスク ⭐

**次に実装すべき項目:**
1. **ボーン操作の高度な機能（フェーズ4.1高度化）**
   - ボーンリストUIの実装（選択とステータス表示）
   - 回転制限の実装（人体の自然な可動域）
   - 部分的なボーングループのリセット（上半身/下半身など）
   - ポーズプリセットの保存と読み込み
2. **表情制御の実装（フェーズ4.2開始）**
   - BlendShapeの取得と表示
   - 表情のスライダー制御
   - プリセット表情の実装

**実装完了項目:**
- ✅ VRMボーンの可視化と操作の基礎機能
- ✅ SkeletonHelperとボーンポイントによる骨格視覚化
- ✅ TransformControlsによる回転・移動操作
- ✅ ポーズリセット機能とUI統合

---

## 実装ガイドライン 📝

- 各フェーズの完了後、Playwrightでテストを実行
- 機能追加前に必ずコードレビューを実施
- シンプルな実装を心がけ、段階的に機能拡張
- 適切なファイル分割とコメントの追加
- モジュール化を意識した設計

## UI改善タスク 🎨

### UI-1: Infoボタンのアイコン化
- [x] 現在のテキスト「Info」ボタンをアイコンに変更
- [x] 適切な情報アイコン（ⓘ）の選択・実装
- [x] ホバー時のエフェクト（スケール、影、色変化）
- [x] レスポンシブ対応（モバイル用の拡大サイズ）
- [x] アクセシビリティ（aria-label等）の対応
- [x] クリックイベントの修正（アイコン内要素対応）
- [x] **SVGアイコンへの変更（位置ずれ修正＆デザイン改善）** ✨
  - [x] public/assets/icons/info.svgファイルの実装
  - [x] img要素でのSVG読み込み
  - [x] CSSフィルターで白色表示
  - [x] 位置ずれ修正（flexboxによる正確な中央配置）
  - [x] サイズ調整（14px × 14px、モバイル：16px × 16px）
- [x] Playwrightでの動作確認完了
  - [x] VRM0/VRM1両方でのSVGアイコン表示確認
  - [x] 複数モデルでのアイコン動作確認
  - [x] メタ情報モーダルの正常開閉確認
  - [x] モデル選択機能との干渉なし確認

**🎯 SkeletonHelper線描画問題の解決 2024-06-27**:
- **@pixiv/three-vrmライブラリ調査** ✨
  - [x] node_modules\@pixiv配下のVRM仕様調査実施
  - [x] VRMHumanoid・VRMHumanBone・VRMHumanoidHelperの型定義確認
  - [x] VRMの内部構造解明（humanoid.normalizedHumanBonesRoot、88個ボーン、54個ヒューマノイドボーン）
  - [x] SkeletonHelper作成手順の複数アプローチ検証（SkinnedMeshから作成、正規化ルートから作成、スケルトンルートから作成）
- **カスタムボーン線描画システム実装** ✨
  - [x] SkeletonHelperのposition.count問題を特定（16個ポイントしか表示されず、86本線が必要）
  - [x] 手動ボーン接続解析システム構築（親子ボーン関係の動的検出、86本のボーン接続線生成）
  - [x] THREE.LineSegmentsによるカスタムボーン線描画（BufferGeometry、黄色マテリアル、最前面表示設定）
  - [x] VRMBoneController.tsにcreateCustomBoneLines()メソッド追加（完全なボーン構造の可視化実現）
- **統合的なボーン表示システム完成** ✨
  - [x] SkeletonHelper（16本線）+カスタムボーン線（86本線）のハイブリッド表示
  - [x] toggleBoneVisibility()でSkeletonHelper・カスタム線・ボーンポイントの一括表示切替
  - [x] clearBoneVisualization()でのリソース管理強化（customBoneLines追加）
  - [x] 最前面表示設定完備（renderOrder設定、depthTest/Write=false、透明度・色調整）
- **動作確認・テスト完了** ✅
  - [x] Playwright MCPでの包括的テスト（VRMサンプル読み込み、ボーン線・ポイント表示確認）
  - [x] 86本のボーン接続線の正常描画確認（首・胴体・腕・脚・指・尻尾・耳・目など全身骨格）
  - [x] 表示/非表示切り替え動作確認（UIボタン状態変更、視覚的な切り替え確認）
  - [x] スクリーンショット比較検証（ボーン線・ポイント表示時と非表示時の正確な切り替え）

**⭐ 最終成果**: VRMビューワーで3Dビューポート上にボーン（SkeletonHelperの黄色い線）とボーンポイント（球体）を最前面に正しく可視化し、UIのボーン表示/非表示ボタンで確実に切り替えられる機能が完全に実装されました。86本のボーン接続線により、VRM内部の完全なスケルトン構造が視覚化されています。

**🐛 ボーン表示バグ修正 2024-06-27**:
- **VRM追加・削除時のボーン表示一貫性確保** ✨
  - [x] 「VRM0追加」「VRM1追加」でボーンが表示されない問題を解決
    - addVRMFromArrayBufferで新しく追加されたVRMをボーンコントローラーに正しく設定
    - ボーンコントローラーが最新追加モデルに確実に適用されるよう修正
  - [x] モデル削除時にボーン表示が残る問題を解決
    - removeVRMAtIndexでcurrentVRM削除時にboneController.setVRM(null)を追加
    - removeAllVRMsでボーンコントローラーのクリア処理を追加
  - [x] ファイル選択・ドラッグ&ドロップ経由でもボーン表示が正常動作
    - loadVRMFromFile（ファイル選択）→ loadVRMFromArrayBuffer経由で既存処理を活用
    - addVRMFile（ドラッグ&ドロップ）→ addVRMFromArrayBuffer経由で修正済み処理を活用
  - [x] Playwright MCPでの包括的テスト実施
    - VRM0追加→モデル選択→ボーン表示/非表示切り替え→個別削除の一連動作確認
    - VRM1サンプル読み込み→全モデル削除での完全クリア確認
    - 各読み込み経路でのボーン一貫性動作確認完了

**✅ 修正完了**: 全てのVRM読み込み・追加・削除経路でボーン表示が一貫して正常動作。ユーザー体験が大幅に向上しました。
