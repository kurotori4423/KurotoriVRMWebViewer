# VRMビューワー 実装Todo

## フェーズ1: 基盤構築 🏗️

### 1.0 Gitリポジトリの初期化
- [x] Gitリポジトリの初期化
- [x] .gitign### 3.1 VRMメタ情報の表示
- [x] メタ情報パネルの作成
  - [x] 読み込み済モデルリストにInfoボタンを追加
  - [x] メタ情報モーダルウィンドウのUI作成
  - [x] ×ボタン、ESCキー、背景クリックでの閉じる機能
- [x] モデル名、作者、ライセンス情報の表示
- [x] サムネイル画像の表示（実装完了）
- [x] VRMバージョン情報の表示
- [x] **VRM0/VRM1バージョン検知とメタ情報対応** ✨
  - [x] VRM0系の特徴的プロパティ（title, author, commercialUssageName等）による正確なバージョン検知
  - [x] VRM1系とVRM0系のメタ情報構造の違いに対応した正規化処理
  - [x] VRM0系: title→name変換, author→authors配列変換, 詳細なライセンス情報表示
  - [x] VRM1系: 既存のname, authors配列, 商用利用・改変許可等の表示
  - [x] バージョンごとの適切なUI表示分岐（バージョンバッジ、ライセンス詳細、サムネイル等）
- [x] **VRM1系メタ情報表示の充実** ✨
  - [x] 再配布許可・クレジット表記・サードパーティライセンス項目の追加
  - [x] 使用許可・利用制限セクションの実装
    - [x] アバター使用許可（onlyAuthor, onlySeparatelyLicensedPerson, everyone）
    - [x] 過激な暴力表現許可（allowExcessivelyViolentUsage）
    - [x] 過激な性的表現許可（allowExcessivelySexualUsage）
    - [x] 政治・宗教利用許可（allowPoliticalOrReligiousUsage）
    - [x] 反社会的・ヘイト利用許可（allowAntisocialOrHateUsage）
  - [x] 公式ドキュメントに基づく完全なVRM1.0メタ情報対応
- [x] Playwrightでの動作確認完了
  - [x] VRM0/VRM1両方でのバージョン検知確認
  - [x] 各バージョンのメタ情報表示確認
  - [x] 複数モデルでの動作確認
  - [x] モーダル開閉の動作確認
  - [x] モデル選択機能への影響なし確認
  - [x] VRM1系の充実したメタ情報表示確認- [x] 初回コミットの実行

### 1.1 開発環境セットアップ
- [x] Viteプロジェクトの初期化
- [x] TypeScript設定
- [x] 必要なライブラリのインストール
  - [x] three.js
  - [x] @pixiv/three-vrm
  - [x] lil-gui
- [x] 基本的なディレクトリ構造の作成

### 1.2 基本的な3Dシーンの構築
- [x] three.jsの基本セットアップ（Scene, Camera, Renderer）
- [x] OrbitControlsの追加（カメラ操作）
- [x] 基本的なライティングの設定
- [x] グリッドとアックスヘルパーの表示
- [x] ブラウザでの表示確認

## フェーズ2: VRM基本機能 📱

### 2.1 VRMファイルの読み込み
- [x] ファイル選択UIの作成
- [x] VRMローダーの実装
- [x] VRM0系の読み込み対応
- [x] VRM1系の読み込み対応
- [x] エラーハンドリングの実装

### 2.2 VRMモデルの表示
- [x] VRMモデルをシーンに追加
- [x] モデルの中央配置
- [x] モデルのスケール調整機能
- [x] 複数体表示の基本実装
- [x] VRMモデルリスト表示機能
  - [x] 読み込み済みモデルのリスト表示UI作成
  - [x] モデル名・サムネイル・読み込み順序の表示
  - [x] リスト項目のクリック選択機能  - [x] モデル選択UI実装
    - [x] 現在選択中のモデルの明確な識別
    - [x] 選択状態の視覚的フィードバック
    - [x] キーボード（上下矢印）での選択切り替え
- [x] 選択されたモデルの強調表示
  - [x] 3Dシーン内でのアウトライン表示
  - [x] モデルの一時的なハイライト効果
  - [x] カメラの自動フォーカス機能
  - [x] **バグ修正**: 複数体配置時のアウトライン位置ずれ（シンプルな固定オフセット方式で完全解決）
- [x] 個別モデル操作機能
  - [x] 選択モデルのみの移動・回転・スケール
  - [x] 選択モデルの表示/非表示切り替え
  - [x] 選択モデルの削除機能
  - [x] 選択モデルの複製機能（元データからの再読み込み方式で修正完了）
  - [x] **バグ修正**: モデル選択切り替え時のスライダー値同期（現在選択されたモデルのスケール値にスライダーを更新）

### 2.3 基本的なカメラ・ライト操作
- [x] **three-viewport-gizmoの導入**
  - [x] three-viewport-gizmoライブラリのインストール
  - [x] OrbitControls連携の実装
  - [x] カメラ視点操作ギズモの表示・動作確認
  - [x] UIとの統合（位置調整・スタイル設定）
- [x] カメラ位置のリセット機能
  - [x] デフォルト位置への即座復帰
  - [x] 全体表示への自動調整
  - [x] 滑らかなアニメーション付きリセット
- [x] ライトの明度調整
  - [x] 環境光の強度調整スライダー
  - [x] 方向性ライトの強度調整
  - [x] 複数ライトの統合制御
- [x] 背景色の変更機能
  - [x] カラーピッカーUI
  - [x] プリセット背景色ボタン
  - [x] グラデーション背景の実装

### 2.4 UI整理・改善
- [x] 左サイドバーのレイアウト整理
  - [x] VRMファイル読み込みボタンのシンプル化
  - [x] 読み込み済モデル一覧の配置最適化
  - [x] ライト設定・背景設定の整理
- [x] VRMファイル読み込みモーダルの実装
  - [x] 中央モーダルウィンドウの作成
  - [x] サンプル追加ボタンの移動
  - [x] ドラッグ&ドロップ領域の移動
  - [x] ×ボタンでの閉じる機能
  - [x] ESCキーでの閉じる機能
  - [x] プリセットボタンの統合
- [x] 選択モデル詳細ウィンドウの実装
  - [x] 画面右下のモデル操作ウィンドウ作成
  - [x] スケール設定の移動
  - [x] フォーカス・非表示・削除ボタンの移動
  - [x] 今後の拡張に対応したUI設計
  - [x] ×ボタンでの閉じる機能

## フェーズ3: メタ情報と基本UI 📋 ✅

### 3.1 VRMメタ情報表示
- [x] メタ情報パネルの作成
  - [x] 読み込み済モデルリストにInfoボタンを追加
  - [x] メタ情報モーダルウィンドウのUI作成
  - [x] ×ボタン、ESCキー、背景クリックでの閉じる機能
- [x] モデル名、作者、ライセンス情報の表示
- [x] サムネイル画像の表示（実装完了）
  - [x] **VRM1系のサムネイル画像表示対応（完全解決）** ✨
    - [x] HTMLImageElementをCanvas APIでDataURLに変換
    - [x] extractVRM1ThumbnailImage関数でVRM1統一処理実装
  - [x] **VRM0系のサムネイル画像表示対応（完全解決）** ✨
    - [x] textureプロパティからImageBitmap/HTMLImageElement対応
    - [x] extractVRM0ThumbnailImage関数でcanvas変換実装
    - [x] **main.ts表示バグ修正**: thumbnailImage.src → thumbnailImageに修正してDataURL表示を正常化
  - [x] **VRM0/VRM1統一サムネイル処理完成**: 両方ともDataURL文字列で統一し、美しいサムネイル表示を実現
  - [x] **サムネイル横並びレイアウト完成** ✨
    - [x] 基本情報セクションでサムネイル画像（左）と基本情報（右）の横並び表示
    - [x] レスポンシブ対応（狭い画面では縦並びに自動切り替え）
    - [x] CSS `basic-info-container`, `thumbnail-container`, `meta-thumbnail-inline`, `basic-info-details`完成
    - [x] VRM0/VRM1両方での横並びレイアウト動作確認完了
- [x] VRMバージョン情報の表示
  - [x] VRM0/VRM1の自動検知とメタ情報正規化
  - [x] バージョンごとの適切なメタ情報項目表示
- [x] Playwrightでの動作確認完了
  - [x] 複数モデルでの動作確認
  - [x] モーダル開閉の動作確認
  - [x] モデル選択機能への影響なし確認
  - [x] VRM0/VRM1サンプルでのサムネイル表示確認完了

### 3.2 lil-gui統合
- [ ] lil-guiのセットアップ
- [ ] カメラ操作パネル
- [ ] ライト調整パネル
- [ ] モデル表示設定パネル

## フェーズ4: ポージング機能 🎨

### 4.1 ボーン操作の基礎
- [ ] ボーンの可視化
- [ ] TransformControlsの統合
- [ ] 基本的なボーン回転機能
- [ ] ポーズのリセット機能

### 4.2 表情制御
- [ ] BlendShapeの取得と表示
- [ ] 表情のスライダー制御
- [ ] プリセット表情の実装

### 4.3 基本的なポージング
- [ ] 手・腕のポージング
- [ ] 頭・首のポージング
- [ ] 基本的な全身ポーズの保存・読み込み

## フェーズ5: 高度な機能 ⚡

### 5.1 VRMAアニメーション
- [ ] VRMAファイルの読み込み
- [ ] アニメーション再生機能
- [ ] 再生コントロール（再生、停止、シーク）

### 5.2 IKシステム
- [ ] 基本的なIKソルバーの実装
- [ ] 手・足のIK操作
- [ ] 視線IKの実装

### 5.3 複数体管理
- [ ] 複数VRMの管理システム
- [ ] モデル選択UI
- [ ] 個別のポーズ管理

## フェーズ6: パフォーマンス最適化・エラーハンドリング 🚀

### 6.1 パフォーマンス最適化
- [ ] レンダリング最適化
  - [ ] フラストラムカリング適用
  - [ ] LOD（Level of Detail）システム実装
  - [ ] 描画バッチング最適化
- [ ] メモリ管理
  - [ ] テクスチャ圧縮・最適化
  - [ ] 不要なリソースの自動解放
  - [ ] メモリ使用量監視機能
- [ ] 読み込み最適化
  - [ ] プログレッシブ読み込み
  - [ ] キャッシュ機能実装
  - [ ] 非同期処理の最適化

### 6.2 エラーハンドリング強化
- [ ] ユーザーフレンドリーなエラー表示
  - [ ] 詳細なエラーメッセージ
  - [ ] 解決策の提案機能
  - [ ] エラーログの保存・共有
- [ ] 復旧機能
  - [ ] 自動復旧の試行
  - [ ] セーフモードの実装
  - [ ] バックアップ・復元機能

## フェーズ7: モバイル対応・外部連携 📱

### 7.1 モバイル対応
- [ ] タッチ操作の実装
- [ ] レスポンシブデザインの適用
- [ ] モバイル向けパフォーマンス最適化

### 7.2 VRoidHub連携
- [ ] VRoidHub APIの調査
- [ ] 認証機能の実装
- [ ] モデル検索・ダウンロード機能

## 現在の優先タスク ⭐

**次に実装すべき項目（フェーズ3開始）:**
1. **VRMメタ情報表示**
   - メタ情報パネルの作成
   - モデル名、作者、ライセンス情報の表示
   - サムネイル画像の表示
   - VRMバージョン情報の表示

**実装後の次のステップ（フェーズ4）:**
- ポージング機能の実装
- ボーン操作の基礎

---

## 実装ガイドライン 📝

- 各フェーズの完了後、Playwrightでテストを実行
- 機能追加前に必ずコードレビューを実施
- シンプルな実装を心がけ、段階的に機能拡張
- 適切なファイル分割とコメントの追加
- モジュール化を意識した設計

## 進捗管理 📊

- [x] フェーズ1完了
- [x] フェーズ2完了  
- [x] フェーズ3完了（VRM0/VRM1メタ情報・サムネイル表示）
- [ ] フェーズ4完了
- [ ] フェーズ5完了
- [ ] フェーズ6完了
