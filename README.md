# KurotoriVRM WebViewer - 使用方法ガイド

WebGLベースで動作するVRMビューワーです。ブラウザ上でVRMモデルの表示・操作・アニメーション再生ができる高機能Webアプリケーションです。

## 🌐 ライブデモ

**本番環境**: https://your-username.github.io/KurotoriVRMWebViewer/

*GitHub Pagesで自動デプロイされます。mainブランチへのpush時に自動更新されます。*

## 🚀 クイックスタート

### 開発環境での起動
```bash
npm install
npm run dev
```
ブラウザで `http://localhost:5173` にアクセスしてください。

### 本番ビルド
```bash
npm run build
npm run preview
```

### GitHub Pagesデプロイ
```bash
# mainブランチにpushすると自動デプロイ
git add .
git commit -m "Deploy to GitHub Pages"
git push origin main
```

## 📖 基本的な使い方

### 1. VRMファイルの読み込み

#### ファイル選択
1. 左サイドバーの「VRMファイル読み込み」ボタンをクリック
2. モーダルが開くので「ローカルファイル」セクションでファイルを選択
3. 複数のVRMファイルを同時に選択可能

#### ドラッグ&ドロップ
1. 「VRMファイル読み込み」ボタンをクリック
2. ドロップゾーンにVRMファイルをドラッグ&ドロップ
3. 複数ファイルの同時ドロップに対応



### 2. モデルの選択・操作

#### モデル選択
- **マウスクリック**: 3Dビューでモデルをクリックして選択
- **モデルリスト**: 左サイドバーのモデル一覧から選択
- **キーボード**: 数字キー1-5でモデルを直接選択
- **矢印キー**: ←→キーで前後のモデルを選択
- **Escキー**: 選択を解除

#### 選択中モデルの操作
選択すると右下に「選択中モデル設定」モーダルが表示されます：

- **中央寄せ**: モデルを画面中央に配置
- **フォーカス**: カメラをモデルに向ける
- **スケール調整**: スライダーでモデルサイズを変更（0.1-3.0倍）
- **表示/非表示**: モデルの表示切り替え
- **複製**: 選択中のモデルをコピー
- **削除**: 選択中のモデルまたは全モデルを削除

### 3. カメラ操作

#### マウス操作
- **左ドラッグ**: 視点回転
- **右ドラッグ**: パン（平行移動）
- **ホイール**: ズームイン/アウト

#### カメラリセット
- **デフォルト位置**: 初期カメラ位置に戻す
- **全体表示**: 全モデルが見えるように調整
- **アニメーション**: 滑らかにカメラを移動

#### キーボードショートカット
- **Rキー**: カメラをデフォルト位置にリセット

### 4. ライト調整

左サイドバーの「ライト調整」セクションで以下を設定：

#### 環境光（Ambient Light）
- **強度**: 0.0-2.0の範囲で調整
- **色**: カラーピッカーで色を変更

#### 方向性ライト（Directional Light）
- **強度**: 0.0-3.0の範囲で調整
- **色**: カラーピッカーで色を変更

#### リムライト
- **強度**: 0.0-2.0の範囲で調整
- **色**: カラーピッカーで色を変更（デフォルト: 水色）

#### ライト制御
- **ライトヘルパー表示**: ライトの方向を視覚化
- **方向性ライト選択**: ライトを直接操作（実装予定）
- **ライトリセット**: 全ライト設定を初期値に戻す

### 5. 背景設定

左サイドバーの「背景設定」セクションで背景をカスタマイズ：

- **背景色**: カラーピッカーで自由に設定
- **プリセット色**: ワンクリックで設定
  - **白**: 明るい背景
  - **黒**: 暗い背景
  - **グレー**: デフォルトの中間色
- **背景リセット**: デフォルト色（グレー）に戻す

### 6. ボーン操作・ポージング

選択中モデル設定モーダルの「ボーン操作」セクション：

#### ボーン表示
- **ボーン表示切替**: モデルのボーン構造を表示/非表示
- **ポーズリセット**: 全ボーンを初期ポーズに戻す

#### 操作モード
- **回転モード**: ボーンを回転させてポージング
- **移動モード**: ボーンを移動させて調整

#### ボーン選択・操作
- 3Dビューでボーンをクリックして選択
- 選択中のボーン名が表示される
- Transform Controlsでボーンを直接操作

### 7. 🎬 VRMAアニメーション機能

VRMAファイル形式のアニメーション再生に対応しています。

#### VRMAファイルとは
- VRM専用のアニメーションファイル形式
- 3Dキャラクターの動作・表情・視線制御を含む

#### VRMA読み込み・再生

**操作方法:**
1. モデルを選択してポーズタブを開く
2. 「VRMAアニメーション制御」セクションにVRMAファイルをドラッグ&ドロップ
3. 自動で再生が開始されます

**制御機能:**
- **▶️ 再生/⏸️ 一時停止**: アニメーションの再生制御
- **削除**: アニメーションを削除
- **時間表示**: 現在の再生時間をリアルタイム表示

#### VRMA対応の特徴
- **複数VRM対応**: 各モデルで個別のアニメーション再生
- **排他制御**: アニメーション中はボーン操作を自動で無効化
- **高精度タイミング**: `performance.now()`による正確な時間制御
- **VRM個別管理**: モデル削除時の適切なリソース解放



### 8. 😊 表情制御

VRMの表情システムと完全統合された表情制御機能：

#### 表情プリセット
選択中モデル設定モーダルの「表情制御」セクション：
- **joy (喜び)**: 笑顔の表情
- **angry (怒り)**: 怒った表情
- **sorrow (悲しみ)**: 悲しい表情
- **fun (楽しい)**: 楽しそうな表情
- **その他**: VRMファイルに含まれる全表情プリセット

#### 表情操作
- **スライダー制御**: 各表情の強度を0-1で調整
- **リアルタイム反映**: スライダー操作が即座に反映
- **表情リセット**: 全表情を初期状態に戻す
- **表情ブレンド**: 複数表情の同時適用

## 🎯 高度な機能

### VRMメタ情報の表示
- モデルリストの「ℹ️」ボタンをクリック
- VRMファイルに含まれるメタデータを確認
- 作者情報、ライセンス、使用条件などを表示

### 複数モデル管理
- 最大5体まで同時読み込み可能
- 各モデルを個別に選択・操作
- モデルごとに独立したスケール・表示設定
- 個別のアニメーション・表情制御

### ViewportGizmo
- 画面右上の3Dギズモで視点を素早く変更
- X/Y/Z軸方向への瞬時移動
- 直感的なカメラ操作

### ライト制御の強化
- **方向性ライト選択機能**: ライトを直接クリックして選択・操作
- **ライトヘルパー表示**: ライトの方向と範囲を視覚化
- **高度なライト調整**: 強度・色・位置の詳細制御

### UI/UX改善
- **glassmorphism準拠**: 現代的で透明感のあるデザイン
- **レスポンシブ対応**: 各種画面サイズに最適化
- **アクセシビリティ**: キーボード操作・スクリーンリーダー対応
- **状態管理強化**: UI同期・イベント駆動型設計

## ⌨️ キーボードショートカット一覧

| キー | 機能 |
|------|------|
| `1-5` | モデル1-5を直接選択 |
| `←` `→` | 前/次のモデルを選択 |
| `Esc` | モデル選択を解除 |
| `R` | カメラをデフォルト位置にリセット |

## 🔧 技術仕様

### 対応フォーマット
- **VRM 0.x**: 従来のVRM形式
- **VRM 1.0**: 最新のVRM形式
- **VRMA**: VRMアニメーションファイル

### 技術スタック
- **3D描画**: Three.js
- **VRM読込**: @pixiv/three-vrm
- **VRMAアニメーション**: @pixiv/three-vrm-animation v3.4.1
- **開発環境**: Vite 7.0.0 + TypeScript
- **GUI**: lil-gui
- **3Dギズモ**: three-viewport-gizmo

### パフォーマンス仕様
- **フレームレート**: 60FPS維持
- **同時表示**: 最大5体のVRMモデル
- **アニメーション**: 複数VRM同時再生対応
- **メモリ管理**: 自動リソース解放・リーク防止

### ブラウザ要件
- WebGL対応ブラウザ
- モダンブラウザ（Chrome, Firefox, Safari, Edge）
- JavaScript有効
- WebGL 1.0以上（推奨: WebGL 2.0）

## 🐛 トラブルシューティング

### ファイルが読み込めない場合
1. VRM/VRMAファイルが破損していないか確認
2. ファイルサイズが大きすぎないか確認（推奨: 100MB以下）
3. ブラウザのコンソールでエラーを確認
4. VRMAファイルの場合、対応するVRMモデルが読み込まれているか確認

### 動作が重い場合
1. 複数モデルを読み込んでいる場合は削除を検討
2. アニメーション再生中の場合は一時停止または削除
3. ライトヘルパーを非表示にする
4. ブラウザを再読み込みする
5. 他のタブを閉じてメモリを解放

### ボーン操作ができない場合
1. モデルが選択されているか確認
2. ボーン表示が有効になっているか確認
3. 操作モード（回転/移動）を確認
4. **アニメーション再生中でないか確認**（アニメーション中はボーン操作が無効化されます）

### VRMAアニメーションが動作しない場合
1. VRMAファイルがVRMモデルと互換性があるか確認
2. 正しいVRMモデルが選択されているか確認
3. ブラウザがWebGL 2.0をサポートしているか確認
4. アニメーションファイルが破損していないか確認
5. 複数アニメーション同時再生の場合は個別に確認

### 表情制御が動作しない場合
1. VRMファイルに表情データが含まれているか確認
2. モデルが正しく選択されているか確認
3. VRM 1.0形式の場合、表情仕様が正しいか確認

## 📄 ライセンス

MIT License

## 👥 開発者

kurotori

---

**Note**: このビューワーは活発に開発が続けられており、定期的に新機能が追加されています。バグ報告や機能要望はIssueまでお願いします。
